---
title: 从 ES6 写全屏滚动插件说起
date: 2016-04-28 22:56:37
tags: [JavaScript,ES6]
categories: JavaScript
e_title: develop-full-page-scroll-by-es6
---

这篇文章将介绍如何使用原生 JS （主要使用 ES6 语法）实现全屏滚动插件，主要包括下面内容：

第一部分介绍全屏滚动插件的实现：

* 实现原理

* 截流函数/debounce 函数做性能优化，并比较异同

* 兼容处理（兼容事件、惰性加载、触屏事件）

第二部分介绍 ES6 相关知识：

* class 使用

* 箭头函数使用，主要是 this 指向（定义时的 lexical scope，或者说所在函数运行时的 this，后期不能修改，bind apply 也不行）

* polyfill 做兼容性

* babel 简介，为什么不能转 assign 这里方法，哪些可以转

## 一 前面的话

现在已经有很多全屏滚动插件了，比如著名的 [fullPage](https://github.com/alvarotrigo/fullPage.js)，那为什么还要自己造轮子呢？

首先，现有轮子有以下问题：

* 首先，最大的问题是最流行的几个插件都依赖 jQuery，这意味着在使用 React 或者 Vue 的项目中使用是一件十分蛋疼的事：我只需要一个全屏滚动功能，却还需要把 jQuery 引入，有种杀鸡使用宰牛刀的感觉；
* 其次，现有的很多全屏滚动插件功能往往都十分丰富，这在前几年是优势，但现在（2018-4）可以看作是劣势：前端开发已经发生了很大变化，其中很重要的一个变化是 ES6 原生支持模块化开发，模块化开发最大的特点是一个模块最好只专注做好一件事，然后再拼成一个完整的系统，从这个角度看，大而全的插件有悖模块化开发的原则。

对比之下，通过原生语言造轮子有以下好处：

* 使用原生语言编写的插件，自身不会受依赖的插件的使用场景而影响自身的使用（现在依赖 jQuery 的插件非常不适合开发单页面应用），所以使用上更加灵活；
* 搭配模块化开发，使用原生语言开发的插件可以只专注一个功能，所以代码量可以很少（我编写的这个全屏滚动插件去掉注释和空行后，全部代码不到 100 行）；
* 最后，随着 JS/CSS/HTML 的发展以及浏览器不断迭代更新，现在使用原生语言编写插件的开发成本越来越低，那为什么不呢？

## 二 实现原理

### 2.1 实现原理

实现原理见下图：page 取当前可视区高度，通过更改容器 `top` 值实现全屏滚动效果。

![全屏滚动实现原理](http://ol9ge41ud.bkt.clouddn.com/full_page_scroll.png)

鉴于这种实现原理，所以对 html 结构就有要求：滚动的页面需包裹在一个父级元素中，如下：

```html
<div id="pureFullPageContainer">
  <div class="page"></div>
  <div class="page"></div>
  <div class="page"></div>
</div>
```

